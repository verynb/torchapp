<div class="tab-menu">
	<div class="box-h">
		<div class="box-flex" data-tkey="userCenter" data-dir="usersconfig" data-transition="fade" onclick="common.loadPage(this,false)"><span class="active">基本信息</span></div>
		<div class="box-flex" data-tkey="userPwd" data-dir="usersconfig" data-transition="fade" onclick="common.loadPage(this,false)"><span class="">修改密码</span></div>
	</div>
</div>
<form>
	<div id="userCenterData" class="list-panel datasource" data-datasource="">
		<!--start-->
		<div class="padding-top-1"></div>
		<div class="list-box img-photo-box">
			<div class="list-defult-body box-h boder-none">
				<div class="box-flex">
					<span class="title">头像</span>
				</div>
				<div class="">
					<img class="header-picture fromfield" data-fromfield="photo" src="img/icon/defult-photo.png" alt="默认照片" onclick="common.pickImg(this)" />
					<input class="editor-input fromfield" data-fromfield="photo" type="hidden" name="photo" value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<!--end-->

		<div class="padding-top-1"></div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">姓名</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="name" type="text" name="name" required="required" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">称呼</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="netName" type="text" name="netName" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">性别</span>
				</div>
				<div class="text-input-box" onclick="pageCom.chooseSex()">
					<input class="editor-input fromfield" data-fromfield="gender" type="text" readonly="readonly" name="gender" required="required" data-warning="请选择性别" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">年龄</span>
				</div>
				<div class="text-input-box">
					<!--<input class="editor-input fromfield" type="text" name="birthday" data-minDate="1970-01-01" readonly="readonly" onclick="common.pickDateYMD(this);" placeholder="未填写" value="" />-->
					<input class="editor-input fromfield" data-fromfield="age" type="number" name="age" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box hidden isrole">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title dataRoleName">角色</span>
				</div>
				<div class="icon-text-box">
					<span class="nav fromfield roleName" data-fromfield="roleName">请选择角色</span>
					<input class="editor-input fromfield" data-fromfield="roleName" type="hidden" name="roleName" required="required" readonly="readonly" data-warning="请选择角色" placeholder="未填写 " value="" />
					<input class="editor-input fromfield" data-fromfield="roleId" type="hidden" name="roleId" value="" />
				</div>
			</div>
		</div>
		<div class="list-box hidden isshool">
			<div class="list-defult-body box-h boder-none">
				<div class="box-flex">
					<span class="title dataRoleName">学校</span>
				</div>
				<div class="icon-text-box">
					<span class="nav fromfield schoolName" data-fromfield="schoolName">请选择角色</span>
					<input class="editor-input fromfield" data-fromfield="schoolIds" type="hidden" name="schoolIds" readonly="readonly" data-warning="请选择角色" placeholder="未填写 " value="" />
				</div>
			</div>
		</div>
		<div class="padding-top-1"></div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">电话</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="mobile" type="text" name="mobile" required="required" data-warning="请选择" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">省市区</span>
				</div>
				<div class="icon-text-box " id="sel_city">
					<span class="nav fromfield set_city" data-unionchar=" " data-fromfield="province,city,area">未选择</span>
					<input hidden="hidden" class="editor-input fromfield" data-fromfield="province" name="province" value="" />
					<input hidden="hidden" class="editor-input fromfield" data-fromfield="city" name="city" value="" />
					<input hidden="hidden" class="editor-input fromfield" data-fromfield="area" name="area" value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">详细地址</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="address" type="text" name="address" data-warning="请选择" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">邮箱</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="email" type="text" name="email" data-check="^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$" data-warning-check="邮箱格式不正确" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h ">
				<div class="box-flex">
					<span class="title">QQ</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="qq" type="text" name="qq" data-check="^[0-9]*$" data-warning-check="qq账号格式不正确" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">加入时间</span>
				</div>
				<div class="icon-text-box ">
					<span class="nav fromfield" data-fromfield="joinTime"></span>
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box heightAuto subNONE">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">特长:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="speciality" placeholder="请输入特长内容..." name="speciality"></textarea>
		</div>
		<div class="list-box heightAuto">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">备注:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="remark" placeholder="请输入备注内容..." name="remark"></textarea>
		</div>

	</div>
</form>

<script type="text/javascript">
	var userIdCenter = null,
		userTypeCenter = null,
		userRoleCenter = null;

	function loaduserCenter(obj) {
		cityfunc.add("sel_city");
		userIdCenter = window.localStorage.getItem(G_COMKEY + ".userId");
		userTypeCenter = window.localStorage.getItem(G_COMKEY + ".userType");
		userRoleCenter = window.localStorage.getItem(G_COMKEY + ".role");
		userRoleCenter = JSON.parse(userRoleCenter);
		if(userTypeCenter == 0) {
			initVolEditInfouserCenter();
			$("#userCenter .isrole").removeClass("hidden");
			if(userRoleCenter.roleCode == "teacher") {
				$("#userCenter .isshool").removeClass("hidden");
			}
		} else if(userTypeCenter == 1) {
			iniSupEditInfouserCenter();
			$("#userCenter .subNONE").removeClass("hidden-important").addClass("hidden-important");
			$("#userCenter input[name='name']").attr("readonly", "readonly");
		}
	}

	function initVolEditInfouserCenter() {
		ajaxFuncs.get({
			urlname: "/api/user/volunteer/" + userIdCenter,
			funcs: {
				funcSuccessful: function(data) {
					var btuHtml = '';
					btuHtml += '<div class="footerBtu bg-color-brown" onclick="volEditFooterFuncPutuserCenter(this)">';
					btuHtml += '<a class="all userCenter-save" href="javascript:void(0);">保存</a>';
					btuHtml += '</div>';
					loadData.load({
						data: data,
						container: "userCenter",
						readOnly: false,
						buttons: btuHtml,
						barbutton: true,
						callback: function() {}
					});
					if(data.roleId == 6) {
						$("#userCenter .isshool").removeClass("hidden");
						if(data.schools.length != 0) {
							var schoolsid = [];
							var schoolsname = [];
							for(var i = 0; i < data.schools.length; i++) {
								schoolsid.push(data.schools[i].id);
								schoolsname.push(data.schools[i].schoolName);
							}
							$("#userCenter .schoolName").html(schoolsname.join(','));
							$("#userCenter input[name='schoolIds']").val(schoolsid.join(','));
						}
					}
				}
			}
		});
	}

	function volEditFooterFuncPutuserCenter(obj) {
		var params = common.serializeToJson("#userCenter form");
		if(!common.validate("#userCenter form", obj)) {
			return false;
		} else {
			var schoolIds = params.schoolIds;
			params.schoolIds = schoolIds.split(',');
			params.id = userIdCenter;
			ajaxFuncs.put({
				clickobj: obj,
				urlname: "/api/user/volunteer",
				params: params,
				funcs: {
					funcSuccessful: function(data) {
						common.toast("编辑成功");
						$.ui.goBack();
					}
				}
			});
		}
	}

	function iniSupEditInfouserCenter() {
		ajaxFuncs.get({
			urlname: "/api/user/sponsor/" + userIdCenter,
			funcs: {
				funcSuccessful: function(data) {
					var btuHtml = '';
					btuHtml += '<div class="footerBtu bg-color-brown" onclick="supEditFooterFuncPutuserCenter(this)">';
					btuHtml += '<a class="all userCenter-save" href="javascript:void(0);">保存</a>';
					btuHtml += '</div>';
					loadData.load({
						data: data,
						container: "userCenter",
						readOnly: false,
						buttons: btuHtml,
						barbutton: true,
						callback: function() {}
					});
				}
			}
		});
	}

	function supEditFooterFuncPutuserCenter(obj) {
		var params = common.serializeToJson("#userCenter form");
		if(!common.validate("#userCenter form", obj)) {
			return false;
		} else {
			params.id = userIdCenter;
			ajaxFuncs.put({
				clickobj: obj,
				urlname: "/api/user/sponsor",
				params: params,
				funcs: {
					funcSuccessful: function(data) {
						common.toast("编辑成功");
						$.ui.goBack();
					}
				}
			})
		}
	}
</script>