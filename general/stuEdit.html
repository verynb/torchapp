<form>
	<div id="stuEditData" class="list-panel datasource" data-datasource="">
		<div class="padding-top-1"></div>
		<!----eidt nicole-->
		<div class="list-box img-photo-box">
			<div class="list-defult-body box-h boder-none">
				<div class="box-flex">
					<span class="title">半身照</span>
				</div>
				<div class="">
					<img class="header-picture fromfield" data-fromfield="headPhoto" src="img/example/1-1.jpg" alt="默认照片" onclick="common.pickImg(this)" />
					<input class="editor-input fromfield" data-fromfield="headPhoto" type="hidden" name="headPhoto" value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<!--end-->
		<div class="padding-top-1"></div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">编号</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="sNo" type="text" name="sNo" required="required" data-warning="学生编号不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h" data-tkey="schChooseR" data-dir="general" data-transition="slide" onclick="common.loadPage(this)">
				<div class="box-flex">
					<span class="title">助学点学校</span>
				</div>
				<div class="icon-text-box min-width">
					<span class="nav fromfield schoolName" data-fromfield="schoolName">选择学校</span>
					<input class="editor-input fromfield" data-fromfield="schoolId" type="hidden" name="schoolId" readonly="readonly" required="required" data-warning="请选择学校" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">姓名</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="name" type="text" name="name" required="required" data-warning="姓名不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h" onclick="pageCom.chooseSex(this);">
				<div class="box-flex">
					<span class="title">性别</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="gender" type="text" name="gender" required="required" readonly="true" data-warning="性别不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">身份证</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="identityCard" type="text" name="identityCard" required="required" oninput="ageFuc(this)" data-warning="身份证不能为空" placeholder="未填写" data-check="^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$" data-warning-check="身份证格式不正确" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">民族</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="nation" type="text" name="nation" required="required" data-warning="名族不能为空" placeholder="未填写" value="汉" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box hidden-important">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">出生日期</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="birthday" type="text" name="birthday" readonly="true" data-minDate="1970-01-01" data-warning="出生日期不能为空" onclick="common.pickDateYMD(this, stuEditpickDateYMD);" placeholder="点此选择您的生日" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">年龄</span>
				</div>
				<div class="text-input-box">
					<!--<span class="nav fromfield data-age" data-fromfield="age">0</span>-->
					<!--<input class="editor-input fromfield" data-fromfield="age" type="hidden" name="age" required="required" data-warning="年龄不能为空" placeholder="未填写" value="" />-->
					<input class="editor-input fromfield data-age" data-fromfield="age" type="number" name="age" required="required" data-warning="年龄不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">身高</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="height" type="number" name="height" required="required" data-warning="身高不能为空" placeholder="未填写（CM）" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">体重</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="weight" type="number" name="weight" required="required" data-warning="体重不能为空" placeholder="未填写KG" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">家庭联系电话</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="familyPhone" type="text" name="familyPhone" required="required" data-warning="请填写家庭联系电话" placeholder="未填写 " value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">省市区</span>
				</div>
				<div class="icon-text-box" id="sel_city4">
					<span class="nav fromfield set_city" data-unionchar=" " data-fromfield="province,city,area">未选择</span>
					<input hidden="hidden" class="editor-input fromfield" required="required" data-warning="省市区不能为空" data-fromfield="province" name="province" value="" />
					<input hidden="hidden" class="editor-input fromfield" required="required" data-warning="省市区不能为空" data-fromfield="city" name="city" value="" />
					<input hidden="hidden" class="editor-input fromfield" required="required" data-warning="省市区不能为空" data-fromfield="area" name="area" value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">家庭地址</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="address" type="text" name="address" required="required" data-warning="详细地址不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<!--<div class="list-defult-body box-h" data-tkey="schChooseR" data-dir="general" data-transition="slide" onclick="common.loadPage(this)">-->
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">就读学校</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="attendSchool" type="text" name="attendSchool" required="required" data-warning="就读学校不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next">
				</div>
			</div>
		</div>

		<div class="list-box">
			<div class="list-defult-body box-h" data-tkey="stuGradeR" data-dir="general" data-transition="slide" onclick="common.loadPage(this)">
				<div class="box-flex">
					<span class="title">年级</span>
				</div>
				<div class="icon-text-box min-width">
					<span class="nav fromfield grade" data-fromfield="grade">选择年级</span>
					<input class="editor-input fromfield" data-fromfield="grade" type="hidden" name="grade" required="required" data-warning="请选择年级" placeholder="未填写" value="" />
					<input class="editor-input fromfield" data-fromfield="gradeCode" type="hidden" name="gradeCode" placeholder="未填写" value="" />
				</div>
				<div class="icon-next">
					<i class="icon-img icon-img-next"></i>
				</div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">班级</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="clbum" type="text" name="clbum" required="required" data-warning="班级不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">班主任</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="classTeacher" type="text" name="classTeacher" required="required" data-warning="班主任不能为空" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">当前资助人</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="sponsorName" type="text" name="sponsorName" readonly="readonly" placeholder="未填写" value="无" />
					<input class="editor-input fromfield" data-fromfield="sponsorId" type="hidden" name="sponsorId" placeholder="未填写" value="" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">当前资助人电话</span>
				</div>
				<div class="text-input-box">
					<input class="editor-input fromfield" data-fromfield="sponsorPhone" type="text" name="sponsorPhone" readonly="readonly" placeholder="未填写" value="无" />
				</div>
				<div class="icon-next"></div>
			</div>
		</div>
		<div class="list-box">
			<div class="list-defult-body box-h stuVolIsShow">
				<div class="box-flex">
					<span class="title">学生状态</span>
				</div>
				<div class="icon-text-box">
					<span class="nav data-statusName"></span>
					<input class="editor-input fromfield" data-fromfield="status" type="hidden" name="status" readonly="readonly" placeholder="未填写" value="" />
				</div>
			</div>
		</div>
		<div class="list-box heightAuto teacherNONE">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">家庭人员构成及身体状况:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="familyComposition" placeholder="请输入备注内容..." name="familyComposition"></textarea>
		</div>
		<div class="list-box heightAuto teacherNONE">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">家庭经济状态描述:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="familyEconomy" placeholder="请输入备注内容..." name="familyEconomy"></textarea>
		</div>
		<div class="list-box heightAuto">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">学习状况及表现描述:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="learningStatus" placeholder="请输入备注内容..." name="learningStatus"></textarea>
		</div>
		<!--<div class="list-box">
			<div class="list-defult-body box-h">
				<div class="box-flex">
					<span class="title">学生状态</span>
				</div>
				<div class="icon-text-box">
					<span class="nav data-statusName"></span>
					<input class="editor-input fromfield" data-fromfield="status" type="hidden" name="status" readonly="readonly" placeholder="未填写" value="" />
				</div>
			</div>
		</div>-->
		<div class="list-box heightAuto ">
			<div class="list-defult-body box-h boder-none heightAuto">
				<div class="box-flex">
					<span class="title">其他:</span>
				</div>
			</div>
			<textarea class="visInfo fromfield" style="height: 20rem; width: 100%;padding: 0.5rem; border: 1px solid #dcdbdb;" data-fromfield="other" placeholder="请输入其他内容..." name="other"></textarea>
		</div>
	</div>
</form>
<script type="text/javascript">
	var stuupdateId = null,
		stuViewStuId;

	function loadstuEdit(obj) {
		pageScrollToTop();
		stuupdateId = $(obj).attr("data-id");
		stuViewStuId = stuupdateId;
		cityfunc.add("sel_city4");
		if(stuupdateId != 0) {
			iniSupEditInfo();
		} else {
			stuEditFooter();
		}

	}

	function stuEditpickDateYMD(birth) {
		var age = common.timeDifference(birth);
		$("#stuEdit input[name='age']").val(age);
		$("#stuEdit span.data-age").text(age);
	}

	function stuEditFooter() {
		var btuHtml = '';
		var jsondata = {};
		btuHtml += '<div class="footerBtu bg-color-brown" onclick="stuEditFooterFuncAdd(this)">';
		btuHtml += '<a class="all stuEdit-save" href="javascript:void(0);">保存</a>';
		btuHtml += '</div>';
		jsondata.container = 'stuEdit';
		jsondata.buttonHtml = btuHtml;
		common.commonFooterBtu(jsondata);
	}

	function ageFuc(obj) {
		var idCard = $(obj).val().trim();
		var check = /^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
		var age = "";
		if(new RegExp(check).test(idCard)) {
			age = common.IdCard(idCard, 3);
		}
		$("#stuEdit input[name='age']").val(age);
		$("#stuEdit span.data-age").text(age);
	}

	function iniSupEditInfo() {
		ajaxFuncs.get({
			urlname: "/api/student/" + stuupdateId,
			funcs: {
				funcSuccessful: function(data) {
					/*---2017-07-31 修改  学生发布至家访后，老师不能修改学生资料*/
					var role = window.localStorage.getItem(G_COMKEY + ".role");
					var userType = window.localStorage.getItem(G_COMKEY + ".userType");
					role = JSON.parse(role);
					if(role.hasOwnProperty('roleCode') && role.roleCode == "teacher") {
						$("#stuEdit .teacherNONE").removeClass("hidden-important").addClass("hidden-important");
						$('#stuEdit .stuVolIsShow').unbind('click');
					} else {
						$('#stuEdit .stuVolIsShow').unbind('click').bind('click', function() {
							pageCom.stuGetStatus(this);
						});
					}
					if(role.hasOwnProperty('roleCode') && role.roleCode == "teacher" && data.status != 0) {
						loadData.load({
							data: data,
							container: "stuEdit",
							readOnly: false,
							barbutton: true,
							callback: function() {
								$("#stuEdit .data-statusName").text(pageCom.stuStatusName(data.status));
								common.toast("该学生处于" + pageCom.stuStatusName(data.status) + "状态下不可编辑");
							}
						});
					} else {
						var btuHtml = '';
						btuHtml += '<div class="footerBtu bg-color-brown" onclick="stuEditFooterFuncPut(this)">';
						btuHtml += '<a class="all stuEdit-save" href="javascript:void(0);">保存</a>';
						btuHtml += '</div>';
						loadData.load({
							data: data,
							container: "stuEdit",
							readOnly: false,
							buttons: btuHtml,
							barbutton: true,
							callback: function() {
								$("#stuEdit .data-statusName").text(pageCom.stuStatusName(data.status));
							}
						});
					}
				}
			}
		});
	}

	function stuEditFooterFuncPut(obj) {
		var params = common.serializeToJson("#stuEdit form");
		if(!common.validate("#stuEdit form", obj)) {
			return false;
		} else {
			params.id = stuupdateId;
			ajaxFuncs.put({
				clickobj: obj,
				urlname: "/api/student",
				params: params,
				funcs: {
					funcSuccessful: function(data) {
						common.toast("编辑成功");
						//						$.ui.parsePanelFunctions($("#stulist"), $.query("#stuEdit").get(0));
						$.ui.goBack();
						$.ui.parsePanelFunctions($.query("#stulist").get(0), $.query("#stuEdit").get(0));
					}
				}
			})
		}
	}

	function stuEditFooterFuncAdd(obj) {
		var params = common.serializeToJson("#stuEdit form");
		if(!common.validate("#stuEdit form", obj)) {
			return false;
		} else {
			ajaxFuncs.post({
				clickobj: obj,
				urlname: "/api/student",
				params: params,
				funcs: {
					funcSuccessful: function(data) {
						common.toast("编辑成功");
						$.ui.goBack();
						$.ui.parsePanelFunctions($("#stulist"), $.query("#stuEdit").get(0));
					}
				}
			})
		}
	}
</script>